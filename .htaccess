# BEGIN LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
<IfModule LiteSpeed>
RewriteEngine on
CacheLookup on
RewriteRule .* - [E=Cache-Control:no-autoflush]
RewriteRule litespeed/debug/.*\.log$ - [F,L]
RewriteRule \.litespeed_conf\.dat - [F,L]

### marker ASYNC start ###
RewriteCond %{REQUEST_URI} /wp-admin/admin-ajax\.php
RewriteCond %{QUERY_STRING} action=async_litespeed
RewriteRule .* - [E=noabort:1]
### marker ASYNC end ###

### marker MOBILE start ###
RewriteCond %{HTTP_USER_AGENT} Mobile|Android|Silk/|Kindle|BlackBerry|Opera\ Mini|Opera\ Mobi [NC]
RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+ismobile]
### marker MOBILE end ###

### marker LOGIN COOKIE start ###
RewriteRule .? - [E="Cache-Vary:,wp-postpass_3b2870511fe8cde996ab168711e63429"]
### marker LOGIN COOKIE end ###

### marker WEBP start ###
RewriteCond %{HTTP_ACCEPT} image/webp [OR]
RewriteCond %{HTTP_USER_AGENT} iPhone.*Version/(1[4-9]|[2-9][0-9]|[1-9][0-9]{2,}).*Safari [OR]
RewriteCond %{HTTP_USER_AGENT} Firefox/([6-9][0-9]|[1-9][0-9]{2,})
RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]
### marker WEBP end ###

### marker DROPQS start ###
CacheKeyModify -qs:fbclid
CacheKeyModify -qs:gclid
CacheKeyModify -qs:utm*
CacheKeyModify -qs:_ga
### marker DROPQS end ###

</IfModule>
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END LSCACHE
# BEGIN NON_LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
### marker BROWSER CACHE start ###
<IfModule mod_expires.c>
ExpiresActive on
ExpiresByType application/pdf A315576
ExpiresByType image/x-icon A315576
ExpiresByType image/vnd.microsoft.icon A315576
ExpiresByType image/svg+xml A315576

ExpiresByType image/jpg A315576
ExpiresByType image/jpeg A315576
ExpiresByType image/png A315576
ExpiresByType image/gif A315576
ExpiresByType image/webp A315576
ExpiresByType image/avif A315576

ExpiresByType video/ogg A315576
ExpiresByType audio/ogg A315576
ExpiresByType video/mp4 A315576
ExpiresByType video/webm A315576

ExpiresByType text/css A315576
ExpiresByType text/javascript A315576
ExpiresByType application/javascript A315576
ExpiresByType application/x-javascript A315576

ExpiresByType application/x-font-ttf A315576
ExpiresByType application/x-font-woff A315576
ExpiresByType application/font-woff A315576
ExpiresByType application/font-woff2 A315576
ExpiresByType application/vnd.ms-fontobject A315576
ExpiresByType font/ttf A315576
ExpiresByType font/otf A315576
ExpiresByType font/woff A315576
ExpiresByType font/woff2 A315576

</IfModule>
### marker BROWSER CACHE end ###

## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END NON_LSCACHE
# OPTIMIZED HTACCESS FOR LITESPEED & WORDPRESS PERFORMANCE

# Security Headers
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# LiteSpeed Cache Rules
<IfModule LiteSpeed>
    # Enable LiteSpeed Cache
    CacheLookup public on

    # Cache Control
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
        CacheEnable public
        ExpiresActive On
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/avif "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType application/font-woff "access plus 1 year"
        ExpiresByType application/font-woff2 "access plus 1 year"
    </LocationMatch>

    # ESI for dynamic content

# Cache wp-includes static files (including in admin area)
<IfModule LiteSpeed>
    # Enable caching for wp-includes static assets even in admin
    <LocationMatch "^/wp-includes/.*\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
        CacheEnable public
        ExpiresActive On
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType text/javascript "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/avif "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType application/font-woff "access plus 1 year"
        ExpiresByType application/font-woff2 "access plus 1 year"
        ExpiresByType application/x-font-ttf "access plus 1 year"
        ExpiresByType application/x-font-woff "access plus 1 year"
        Header set Cache-Control "public, max-age=31536000, immutable"
        Header unset ETag
        FileETag None
    </LocationMatch>
    
    # Cache wp-admin static assets (CSS, JS, images)
    <LocationMatch "^/wp-admin/.*\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
        CacheEnable public
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/webp "access plus 1 month"
        ExpiresByType image/avif "access plus 1 month"
        ExpiresByType image/svg+xml "access plus 1 month"
        ExpiresByType font/woff "access plus 1 month"
        ExpiresByType font/woff2 "access plus 1 month"
        ExpiresByType application/font-woff "access plus 1 month"
        ExpiresByType application/font-woff2 "access plus 1 month"
        Header set Cache-Control "public, max-age=2592000"
    </LocationMatch>
</IfModule>

    CacheDisable public /wp-admin/
    CacheDisable public /wp-login.php
    CacheDisable public /wp-json/
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# Brotli Compression for LiteSpeed
<IfModule mod_brotli.c>
    BrotliFilterByType text/plain text/html text/css application/javascript application/json text/xml application/xml application/xml+rss text/javascript image/svg+xml
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType application/x-javascript "access plus 1 year"
    ExpiresByType text/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/avif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType application/x-font-ttf "access plus 1 year"
    ExpiresByType application/x-font-woff "access plus 1 year"
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/json "access plus 1 hour"
</IfModule>

# Cache Control Headers
<IfModule mod_headers.c>
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
        Header unset ETag
        FileETag None
    </FilesMatch>

    <FilesMatch "\.(html|htm)$">
        Header set Cache-Control "public, max-age=3600"
    </FilesMatch>
</IfModule>

# Security Rules
<Files wp-config.php>
    Order allow,deny
    Deny from all
</Files>

<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Disable PHP execution in uploads
<Directory "/usr/local/lsws/Buy/html/wp-content/uploads/">
    <Files "*.php">
        Order allow,deny
        Deny from all
    </Files>
</Directory>

# WordPress Rewrite Rules
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Handle SSL and www redirects
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # WordPress pretty permalinks
    RewriteRule ^index\.php$ - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.php [L]
</IfModule>

# Prevent access to sensitive files
<FilesMatch "(wp-config\.php|\.htaccess|liesmich\.html|readme\.html|readme\.txt|license\.txt)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent access to theme files
# <IfModule mod_rewrite.c>
#     RewriteCond %{REQUEST_URI} !^/wp-admin/
#     RewriteCond %{REQUEST_URI} !^/wp-includes/
#     RewriteRule wp-admin/includes/ - [F,L]
#     RewriteRule !^wp-includes/ - [S=3]
#     RewriteRule ^wp-includes/[^/]+\.php$ - [F,L]
#     RewriteRule ^wp-includes/js/tinymce/langs/.+\.php - [F,L]
#     RewriteRule ^wp-includes/theme-compat/ - [F,L]
# </IfModule>

# Block bad bots and scrapers
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_USER_AGENT} (SemrushBot|AhrefsBot|MJ12bot|DotBot) [NC]
    RewriteRule .* - [F]
</IfModule>


# Remove server signature
ServerTokens Off

# BEGIN WordPress
# The directives (lines) between "BEGIN WordPress" and "END WordPress" are
# dynamically generated, and should only be modified via WordPress filters.
# Any changes to the directives between these markers will be overwritten.
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress

# Prevent hotlinking (improved version)
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?buy\.mobilo\.dev/ [NC]
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?mobilo\.dev/ [NC]
    RewriteCond %{REQUEST_URI} !woocommerce-placeholder [NC]
    RewriteRule \.(gif|jpg|jpeg|png|webp|avif)$ - [F]
</IfModule>

# Additional caching for wp-includes and wp-admin static files
<IfModule mod_expires.c>
    # Cache wp-includes static files aggressively
    <Directory "wp-includes">
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
            ExpiresActive On
            ExpiresByType text/css "access plus 1 year"
            ExpiresByType application/javascript "access plus 1 year"
            ExpiresByType text/javascript "access plus 1 year"
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/gif "access plus 1 year"
            ExpiresByType image/webp "access plus 1 year"
            ExpiresByType image/avif "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
            ExpiresByType font/woff "access plus 1 year"
            ExpiresByType font/woff2 "access plus 1 year"
            ExpiresByType application/font-woff "access plus 1 year"
            ExpiresByType application/font-woff2 "access plus 1 year"
            ExpiresByType application/x-font-ttf "access plus 1 year"
            ExpiresByType application/x-font-woff "access plus 1 year"
        </FilesMatch>
    </Directory>
    
    # Cache wp-admin static files with shorter expiry
    <Directory "wp-admin">
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
            ExpiresActive On
            ExpiresByType text/css "access plus 1 month"
            ExpiresByType application/javascript "access plus 1 month"
            ExpiresByType text/javascript "access plus 1 month"
            ExpiresByType image/png "access plus 1 month"
            ExpiresByType image/jpg "access plus 1 month"
            ExpiresByType image/jpeg "access plus 1 month"
            ExpiresByType image/gif "access plus 1 month"
            ExpiresByType image/webp "access plus 1 month"
            ExpiresByType image/avif "access plus 1 month"
            ExpiresByType image/svg+xml "access plus 1 month"
            ExpiresByType font/woff "access plus 1 month"
            ExpiresByType font/woff2 "access plus 1 month"
            ExpiresByType application/font-woff "access plus 1 month"
            ExpiresByType application/font-woff2 "access plus 1 month"
        </FilesMatch>
    </Directory>
</IfModule>

<IfModule mod_headers.c>
    # Set cache headers for wp-includes static files
    <Directory "wp-includes">
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
            Header set Cache-Control "public, max-age=31536000, immutable"
            Header unset ETag
            FileETag None
        </FilesMatch>
    </Directory>
    
    # Set cache headers for wp-admin static files
    <Directory "wp-admin">
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$">
            Header set Cache-Control "public, max-age=2592000"
            Header append Vary Accept-Encoding
        </FilesMatch>
    </Directory>
</IfModule>

# PHP ini override
php_value memory_limit 256M